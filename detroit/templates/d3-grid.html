<!doctype html>
{% if set_style != "" %}
<head>
  <style>
    {{ set_style }}
  </style>
</head>
{% endif %}
<body>
  <div id="myplot" class="container"> 
  {% for id, plot in plot.items() %}
    <div>
      <h2>{{ plot["title"] }}</h1>
      <div class="plot" id="plot-{{ id }}"></div>
    </div>
  {% endfor %}
  </div>
  <script>{{ get_data }}</script>
  <script type="module">
  import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";
  {% for id, obj in plot.items() %}
  function plot_{{ id }}(){
    {{ obj["code"] }}
  }
  plot_{{ id }}();
  {% endfor %}
  </script>
  {{ get_svg }}
  <script>
    var width;
    var height;
    var mysvg;
    function waitForFigure(selector) {
      return new Promise(resolve => {
          if (document.getElementById(selector).childNodes[0]) {
              return resolve(document.getElementById(selector).childNodes[0]);
          }

          const observer = new MutationObserver(mutations => {
              if (document.getElementById(selector).childNodes[0]) {
                  observer.disconnect();
                  resolve(document.getElementById(selector).childNodes[0]);
              }
          });

          observer.observe(document.body, {
              childList: true,
              subtree: true
          });
      });
    }
    waitForFigure("{{ id }}").then(svg => {
      const div = document.getElementById("myplot");
      const boundingRect = div.getBoundingClientRect();
      width = boundingRect.width;
      height = boundingRect.height;
      {{ code_line }}
    })
  </script>
</body>
